# Texas Hold'em Game Implementation Plan

## Game Overview

Complete single-player Texas Hold'em poker implementation following domain-driven design principles with AI opponents, betting rounds, and mobile-optimized UI. This plan assumes the main casino infrastructure (balance management, audio, RNG services, and shared components) is already implemented.

### Core Game Features
- **Single-Player Experience**: Human player vs 3-5 AI opponents with distinct personalities
- **Complete Texas Hold'em Rules**: Blinds, betting rounds (preflop/flop/turn/river), all-in scenarios
- **AI Opponents**: Three difficulty levels (Tight-Aggressive, Loose-Aggressive, Conservative)
- **Mobile-First Design**: Touch-optimized betting interface with gesture controls
- **Realistic Gameplay**: Position awareness, proper blind structure, side pot calculations
- **Audio Integration**: Card dealing, chip betting, and celebration sounds

## Technical Requirements

### Domain-Driven Architecture
Following DDD principles with clear separation of concerns:
- **Domain Services**: Core game logic isolated from UI and infrastructure
- **Aggregate Roots**: PokerTable manages game state, players, and betting rounds
- **Value Objects**: Immutable cards, chip stacks, and hand strengths
- **Repository Pattern**: Game state persistence and hand history tracking

### Performance Requirements
- **Response Time**: Player actions processed within 200ms
- **AI Decision Time**: 1.5-3 seconds for realistic thinking simulation
- **Memory Usage**: Efficient card and game state management
- **Battery Optimization**: Minimal background processing during AI turns

## Domain Models and Entities

### Core Domain Entities
- **Player Entity**: Represents player with unique ID, chip stack, position, and betting history
- **AIOpponent Entity**: AI player with difficulty level, playing style, and decision-making algorithms  
- **PokerTable Entity**: Game state aggregate root managing blinds, pot, community cards, and player actions
- **Hand Entity**: Individual poker hand with cards and strength evaluation
- **BettingRound Entity**: Manages preflop, flop, turn, river betting sequences

### Value Objects
- **PokerCard**: Suit, rank, and display representation (immutable)
- **ChipStack**: Validates minimum bets, prevents negative balances
- **Position**: Dealer, small blind, big blind, early/late position logic
- **HandStrength**: Royal flush through high card with tie-breaker rules
- **BetAction**: Fold, call, raise amounts with validation rules

## Files to Create

### Domain Layer (Business Logic)
- `src/services/casino/holdem/HoldemGameService.ts` - Core game rules and state management
- `src/services/casino/holdem/HandEvaluatorService.ts` - Poker hand ranking and comparison
- `src/services/casino/holdem/BettingService.ts` - Betting round logic and pot management
- `src/services/casino/holdem/AIPlayerService.ts` - Computer opponent decision making
- `src/services/casino/holdem/DealerService.ts` - Card dealing and shuffling logic

### Types and Value Objects
- `src/types/casino/holdem.types.ts` - All Texas Hold'em domain types
- `src/types/casino/poker-common.types.ts` - Shared poker types (cards, hands)
- `src/utils/casino/holdem/hand-evaluation.utils.ts` - Pure hand comparison functions
- `src/utils/casino/holdem/betting-validation.utils.ts` - Bet size and action validation
- `src/utils/casino/holdem/ai-strategy.utils.ts` - AI decision-making algorithms

### Constants and Configuration
- `src/constants/casino/holdem/game-rules.constants.ts` - Blinds, betting limits, hand rankings
- `src/constants/casino/holdem/ai-personalities.constants.ts` - Different AI opponent types
- `src/constants/casino/holdem/betting-patterns.constants.ts` - Predefined betting scenarios

### Application Services (Hooks)
- `src/hooks/casino/useHoldem.ts` - Main game state management hook
- `src/hooks/casino/useHoldemAI.ts` - AI opponent management
- `src/hooks/casino/useHoldemBetting.ts` - Betting interface and validation
- `src/hooks/casino/useHandAnimation.ts` - Card dealing and reveal animations

### Presentation Layer (Components)
- `src/pages/casino/HoldemPage.tsx` - Main Texas Hold'em page component
- `src/components/casino/holdem/HoldemTable.tsx` - Main game table layout
- `src/components/casino/holdem/CommunityCards.tsx` - Flop, turn, river display
- `src/components/casino/holdem/PlayerPosition.tsx` - Individual player area with chips/cards
- `src/components/casino/holdem/BettingControls.tsx` - Mobile-optimized betting interface
- `src/components/casino/holdem/PotDisplay.tsx` - Current pot amount with side pots
- `src/components/casino/holdem/HandStrengthMeter.tsx` - Visual hand strength indicator
- `src/components/casino/holdem/ActionHistory.tsx` - Recent betting actions log
- `src/components/casino/holdem/WinnerCelebration.tsx` - Hand winner announcement

## Files to Modify

### Infrastructure Integration
- `src/pages/index.ts` - Add HoldemPage export
- `src/App.tsx` - Add holdem routing (`/casino/holdem`)
- `src/types/casino/index.ts` - Add holdem types export
- `src/stores/casinoStore.ts` - Add holdem game state management

## Integration Points with Main Infrastructure

### Required Services (Must Exist)
- `src/services/casino/CasinoRNGService.ts` - Card shuffling and dealing randomization
- `src/stores/casinoStore.ts` - Player balance management and game history
- `src/hooks/casino/useCasinoAudio.ts` - Card dealing sounds and chip sounds
- `src/components/casino/shared/TouchFeedback.tsx` - Betting button interactions

### Audio Integration Points
- **Card Dealing**: `dealCard` sound for each card dealt
- **Betting Actions**: `chipBet`, `chipCall`, `chipRaise` sounds
- **Game Events**: `cardFold`, `winBig`, `winSmall` celebration sounds
- **Ambient**: Background casino atmosphere during gameplay

### Balance Integration
- **Buy-in Validation**: Check available balance before game start
- **Bet Processing**: Real-time balance updates during betting rounds
- **Winnings Distribution**: Automatic balance updates on hand completion
- **Session Tracking**: Win/loss statistics integration with casino store

## Detailed Implementation Steps

### Phase 1: Core Domain Services (Week 1)
1. **Create Domain Types** (`holdem.types.ts`, `poker-common.types.ts`)
   - Define all poker entities, value objects, and interfaces
   - Establish clear contracts between domain services

2. **Implement Hand Evaluator** (`HandEvaluatorService.ts`)
   - Standard poker hand rankings (Royal Flush → High Card)
   - Tie-breaker logic with kickers and side cards
   - Efficient hand comparison algorithms

3. **Build Dealer Service** (`DealerService.ts`)
   - Card shuffling using casino RNG service
   - Hole card and community card dealing logic
   - Deck management and card validation

### Phase 2: Game Logic Foundation (Week 2)
1. **Betting Service Implementation** (`BettingService.ts`)
   - Blinds posting and collection
   - Bet validation (minimum raise rules, all-in scenarios)
   - Pot management and side pot calculations
   - Betting round state transitions

2. **Core Game Service** (`HoldemGameService.ts`)
   - Hand lifecycle management (deal → betting → showdown)
   - Player action processing and validation
   - Game state transitions and rule enforcement
   - Winner determination and pot distribution

### Phase 3: AI Opponents (Week 3)
1. **AI Personality System** (`AIPlayerService.ts`)
   - **Tight-Aggressive**: Plays few hands but bets strongly
   - **Loose-Aggressive**: Plays many hands with frequent betting
   - **Conservative**: Calls frequently, rarely raises or bluffs

2. **Decision-Making Algorithms**
   - Hand strength evaluation based on hole cards and community cards
   - Position-based betting adjustments (early vs late position)
   - Pot odds calculations and drawing hand analysis
   - Realistic thinking delays and behavioral patterns

### Phase 4: Mobile UI Implementation (Week 4)
1. **Game Table Layout** (`HoldemTable.tsx`)
   - Responsive design for portrait/landscape orientations
   - 6-player table with clear position indicators
   - Community card area with proper spacing

2. **Betting Interface** (`BettingControls.tsx`)
   - Touch-optimized betting slider (minimum 60x60px targets)
   - Quick bet buttons (check, call, min-raise, pot, all-in)
   - Bet amount validation with visual feedback
   - Gesture support for common actions

3. **Card Display Components**
   - **Hole Cards**: Peek functionality for mobile viewing
   - **Community Cards**: Large, clear card representations (80x120px)
   - **Card Animations**: Smooth dealing and reveal transitions

### Phase 5: Advanced Features (Week 5)
1. **Hand Strength Indicator** (`HandStrengthMeter.tsx`)
   - Real-time hand strength evaluation (0-100%)
   - Drawing possibilities (flush draws, straight draws)
   - Outs calculation and improvement odds

2. **Side Pot Management**
   - Multiple all-in scenarios with proper side pot creation
   - Complex pot distribution for multiple winners
   - Clear visual representation of main and side pots

3. **Action History and Statistics**
   - Recent betting actions log for all players
   - Session statistics (hands played, win rate, biggest pot)
   - AI opponent behavior tracking

## Poker Hand System

### Hand Rankings (Highest to Lowest)
1. **Royal Flush** - A, K, Q, J, 10 of same suit
2. **Straight Flush** - Five consecutive cards of same suit
3. **Four of a Kind** - Four cards of same rank
4. **Full House** - Three of a kind plus a pair
5. **Flush** - Five cards of same suit (non-consecutive)
6. **Straight** - Five consecutive cards of mixed suits
7. **Three of a Kind** - Three cards of same rank
8. **Two Pair** - Two different pairs
9. **One Pair** - Two cards of same rank
10. **High Card** - Highest single card when no pairs exist

### Hand Evaluation Logic
```typescript
interface HandEvaluation {
  rank: HandRank;           // 1-10 (Royal Flush = 1, High Card = 10)
  strength: number;         // 0-1 relative strength within rank
  kickers: PokerCard[];     // Tie-breaker cards
  description: string;      // Human-readable description
}
```

### Tie-Breaking Rules
- **Same Hand Rank**: Compare primary cards first, then kickers
- **Kicker Cards**: Sorted by rank, highest first
- **Split Pots**: Equal hands split the pot evenly
- **Side Pots**: All-in players compete only for pots they contributed to

## AI Opponent Logic

### Personality Profiles

#### Tight-Aggressive (TAG)
- **Hand Selection**: Only plays premium hands (top 15% of starting hands)
- **Betting Style**: Bets and raises aggressively with strong hands
- **Bluffing**: Minimal bluffing, primarily value betting
- **Position Awareness**: Plays tighter in early position, looser in late position

#### Loose-Aggressive (LAG)
- **Hand Selection**: Plays wide range of hands (top 35% of starting hands)
- **Betting Style**: Frequent betting and raising for pressure
- **Bluffing**: Moderate bluffing frequency, especially in position
- **Adaptability**: Adjusts aggression based on opponents and pot size

#### Conservative (Calling Station)
- **Hand Selection**: Plays medium range of hands (top 25% of starting hands)
- **Betting Style**: Prefers calling to raising, rarely bluffs
- **Passive Play**: Checks and calls frequently, rarely takes initiative
- **Predictability**: Consistent patterns make this AI easier to read

### Decision-Making Factors
1. **Hand Strength** (40% weight) - Current hand vs. possible holdings
2. **Position** (25% weight) - Early, middle, late position adjustments  
3. **Pot Odds** (20% weight) - Mathematical calculation of call profitability
4. **Opponent Actions** (15% weight) - Betting patterns and tells

## Betting Rounds Implementation

### Round Structure
1. **Pre-flop** - After hole cards dealt, before community cards
2. **Flop** - After first 3 community cards revealed
3. **Turn** - After 4th community card (the turn) revealed  
4. **River** - After 5th community card (the river) revealed
5. **Showdown** - Hand comparison and winner determination

### Betting Actions
```typescript
type BetAction = 
  | { type: 'fold' }
  | { type: 'check' }  // Only when no bet to call
  | { type: 'call' }   // Match current bet
  | { type: 'raise'; amount: number }  // Increase bet
  | { type: 'all-in'; amount: number } // Bet all remaining chips
```

### Validation Rules
- **Minimum Raise**: Must be at least the size of the previous raise
- **Maximum Bet**: Cannot exceed player's chip stack
- **String Betting Prevention**: Single betting action per turn
- **All-in Protection**: Players can always call with remaining chips

## Mobile-First Design

### Touch Interface Requirements
- **Minimum Touch Targets**: 60x60px for all interactive elements
- **Gesture Support**: Tap to check/call, swipe for betting amounts
- **Visual Feedback**: Immediate response to all touch interactions
- **Haptic Feedback**: Subtle vibrations for betting actions (if supported)

### Responsive Layout
- **Portrait Mode** (Primary): Vertical table layout, betting controls at bottom
- **Landscape Mode** (Secondary): Traditional horizontal table layout
- **Card Scaling**: Dynamic sizing based on screen dimensions
- **Text Readability**: Minimum 16px font size for all game information

### Accessibility Features
- **High Contrast**: Clear distinction between different chip values
- **Screen Reader**: Proper ARIA labels for all game elements
- **Reduced Motion**: Option to disable card dealing animations
- **Large Text**: Scaling support for vision-impaired users

## Audio Integration

### Sound Categories

#### Card Sounds
- `dealCard` - Single card dealing sound
- `shuffleDeck` - Deck shuffling before new hand
- `cardFlip` - Community card reveals
- `cardFold` - Player folding cards

#### Betting Sounds  
- `chipBet` - Placing/raising bets
- `chipCall` - Calling existing bet
- `chipStack` - Organizing chip stacks
- `chipCollect` - Pot collection by winner

#### Game Event Sounds
- `winSmall` - Winning small pot (< 2x big blind)
- `winMedium` - Winning medium pot (2-10x big blind)  
- `winBig` - Winning large pot (> 10x big blind)
- `showdown` - Hand reveal at showdown

### Audio Timing
- **Synchronized**: Card sounds match visual dealing animation
- **Layered**: Multiple sounds can play simultaneously (cards + chips)
- **Ducked**: Background casino ambiance lowers during important sounds
- **Optional**: All sounds can be muted via settings

## Testing Requirements

### Unit Tests
- **Hand Evaluation**: All poker hand rankings and tie-breaker scenarios
- **Betting Logic**: Minimum/maximum bet validation, all-in scenarios
- **AI Decision Making**: Each personality type responds appropriately
- **Pot Calculations**: Main pot and side pot distribution accuracy

### Integration Tests  
- **Game Flow**: Complete hand from deal to showdown
- **Balance Integration**: Proper deduction and crediting of player balance
- **Audio Timing**: Sounds trigger at correct moments
- **State Persistence**: Game state survives page refreshes

### User Experience Tests
- **Mobile Usability**: All touch targets are accessible and responsive
- **Performance**: 60fps during animations, < 200ms action processing
- **Accessibility**: Screen reader compatibility and keyboard navigation
- **Error Handling**: Graceful degradation when services are unavailable

### Edge Case Testing
- **Connection Loss**: Game state preservation during network interruptions
- **Low Balance**: Proper handling when player cannot afford blinds
- **All-in Scenarios**: Complex multi-player all-in side pot calculations
- **Browser Compatibility**: Cross-browser testing for mobile devices

## Implementation Timeline

### Week 1: Foundation
- Domain types and core interfaces
- Hand evaluation system
- Basic dealer service

### Week 2: Game Logic
- Betting service with validation
- Core game service
- Basic game loop implementation

### Week 3: AI System
- AI personality implementation  
- Decision-making algorithms
- Integration with game service

### Week 4: Mobile UI
- Responsive table layout
- Touch-optimized betting interface
- Card display components

### Week 5: Polish & Testing
- Hand strength indicator
- Action history and statistics
- Comprehensive testing suite
- Performance optimization

## Success Criteria

### Functional Requirements
- ✅ Complete Texas Hold'em rules implementation
- ✅ 3 distinct AI personalities with realistic behavior
- ✅ Mobile-optimized touch interface
- ✅ Integration with casino infrastructure
- ✅ Comprehensive error handling

### Performance Requirements  
- ✅ < 200ms response time for player actions
- ✅ < 3MB memory usage for game state
- ✅ 60fps animations on mobile devices
- ✅ < 2 second load time for initial game setup

### User Experience Requirements
- ✅ Intuitive betting interface requiring no tutorial
- ✅ Clear visual feedback for all game states  
- ✅ Accessible design meeting WCAG 2.1 guidelines
- ✅ Offline capability for single-player mode
- ✅ Comprehensive audio feedback system

This implementation plan provides a complete roadmap for building a professional-quality Texas Hold'em poker game that integrates seamlessly with the existing casino infrastructure while delivering an exceptional mobile gaming experience.