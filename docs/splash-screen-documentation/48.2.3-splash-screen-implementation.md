# Splash Screen Implementation

## Installation and Setup

### Prerequisites
- Node.js and npm installed
- React 16.8+ (React 19 support coming soon)
- Modern JavaScript development environment

### Installation Steps
```bash
# Install the web-specific package (recommended)
npm install @react-spring/web

# If encountering peer dependency issues with newer React versions:
npm install @react-spring/web --legacy-peer-deps
```

### Package Options
- `@react-spring/web` - For web applications (recommended)
- `@react-spring/core` - Platform-agnostic core
- `@react-spring/native` - For React Native
- `@react-spring/three` - For Three.js integration

### Basic Setup
```javascript
import { useSpring, animated } from '@react-spring/web'

const App = () => {
  const springs = useSpring({
    from: { opacity: 0 },
    to: { opacity: 1 }
  })
  
  return (
    <animated.div style={springs}>
      Your app content
    </animated.div>
  )
}
```

## Implementation: Splash Screen Class System

### **Context-Aware Splash Container System**

The splash screen system supports two distinct display contexts through CSS class variants:

#### **Core Container Structure**

```css
.splash-container {
  min-height: 100vh;
  width: 100vw;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--background);
  position: relative;
  overflow: hidden;
}
```

#### **In-App Variant** (`splash-in-app`)
```css
.splash-container.splash-in-app {
  min-height: 100vh;
  width: 100%;
  padding: 0;
}
```

**Purpose**: Displays splash screen within the application's tab system
- **Width**: `100%` (fits within app layout)
- **Position**: `relative` (normal document flow)
- **Context**: Used when splash is viewed as a regular app page
- **Navigation**: Accessible via app tabs

#### **Modal Variant** (`splash-modal`)
```css
.splash-container.splash-modal {
  min-height: 100vh;
  width: 100vw;
  position: fixed;
  top: 0;
  left: 0;
  padding: 0;
  z-index: 50;
  background: var(--background, #ffffff);
}
```

**Purpose**: Full viewport takeover for immersive splash experience
- **Width**: `100vw` (full viewport width)
- **Position**: `fixed` (overlay on top of everything)
- **Z-index**: `50` (above all other content)
- **Context**: Used when splash is triggered as fullscreen modal

### **Splash Modal State Management System**

#### **App Store Integration**

```typescript
interface AppState {
  splashModalOpen: boolean;
  splashModalPage: string | null;
}

// Modal control actions
openSplashModal: (page: string) => void;
closeSplashModal: () => void;
```

#### **Modal Trigger Flow**

1. **User Action**: Clicks "Toggle Fullscreen" in action sheet
2. **State Update**: `openSplashModal('minimalsplash')` called
3. **Store Change**: `splashModalOpen: true, splashModalPage: 'minimalsplash'`
4. **Modal Render**: `SplashModal` component detects state change
5. **Component Render**: Renders splash component with `variant="modal"`

#### **Modal Component Structure**

```typescript
// SplashModal.tsx
const SplashModal: React.FC = () => {
  const splashModalOpen = useAppStore((state) => state.splashModalOpen);
  const splashModalPage = useAppStore((state) => state.splashModalPage);
  const closeSplashModal = useAppStore((state) => state.closeSplashModal);

  if (!splashModalOpen || !splashModalPage) {
    return null;
  }

  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* Backdrop with blur and click-to-close */}
      <div
        className="absolute inset-0 bg-black/80 backdrop-blur-sm"
        onClick={closeSplashModal}
      />

      {/* Modal content with close button */}
      <div className="relative w-full h-full max-w-none">
        <button className="absolute top-6 right-6 z-10" onClick={closeSplashModal}>
          <X className="w-6 h-6" />
        </button>
        {/* Splash component renders here with variant="modal" */}
      </div>
    </div>
  );
};
```

### **Component Implementation Pattern**

#### **Variant Prop Interface**
```typescript
interface SplashPageProps {
  variant?: 'in-app' | 'modal';
}

const SplashPage: React.FC<SplashPageProps> = ({ variant = 'in-app' }) => {
  const containerClass = variant === 'modal' 
    ? 'splash-container splash-modal splash-fade-in'
    : 'splash-container splash-in-app splash-fade-in';

  return (
    <div className={containerClass}>
      <div className="splash-center-content">
        {/* Splash content */}
      </div>
    </div>
  );
};
```

### **CSS Class Hierarchy**

#### **Layout Classes**
- **`splash-container`**: Base full-screen container
- **`splash-in-app`**: In-app variant modifier  
- **`splash-modal`**: Modal variant modifier
- **`splash-center-content`**: Content centering with -20vh offset

#### **Animation Classes**
- **`splash-fade-in`**: 0.6s entrance animation with translateY
- **`crown-glow`**: Glowing text shadow animation for premium elements
- **`modern-dots`**: Loading indicator dots with staggered pulse

#### **Typography Classes**
- **`splash-title`**: 2.5rem responsive title styling
- **`splash-subtitle`**: 1.25rem secondary text styling

### **Usage Scenarios**

#### **Scenario 1: In-App Navigation**
```typescript
// User navigates to splash tab
// Component renders with default variant
<MinimalSplashPage />
// Uses splash-in-app classes
// Fits within app layout
```

#### **Scenario 2: Fullscreen Modal**
```typescript
// User clicks "Toggle Fullscreen" action
// State: { splashModalOpen: true, splashModalPage: 'minimalsplash' }
// Modal renders with explicit variant
<MinimalSplashPage variant="modal" />
// Uses splash-modal classes
// Full viewport takeover
```

### **Key Benefits of This System**

1. **Context Awareness**: Same component adapts to different display contexts
2. **Layout Safety**: No overflow or positioning issues in either mode
3. **State Management**: Clean separation between display and state logic
4. **User Control**: Users can view splash screens both ways
5. **Theme Integration**: All variants respect theme variables and switching
6. **Performance**: No duplicate components, just CSS class switching

## File Structure Implementation

### **Complete File Architecture**

The splash system implements a comprehensive file structure with clear separation of concerns:

```
src/pages/splash/
├── MinimalSplashPage.tsx          ✅ Minimal professional design
├── AnimatedSplashPage.tsx         ✅ Progressive piece assembly
├── LoadingProgressPage.tsx        ✅ Engine loading dashboard
└── BrandedSplashPage.tsx          ✅ Chess academy branding

src/components/
├── MinimalSplashPageWrapper.tsx   ✅ Context integration
├── AnimatedSplashPageWrapper.tsx  ✅ Context integration
├── LoadingProgressPageWrapper.tsx ✅ Context integration
├── BrandedSplashPageWrapper.tsx   ✅ Context integration
└── SplashModal.tsx                ✅ Global modal system

src/hooks/
├── useSplashActions.ts            ✅ Main navigation logic
├── useMinimalSplashActions.ts     ✅ Minimal page actions
├── useAnimatedSplashActions.ts    ✅ Animation page actions
├── useLoadingProgressActions.ts   ✅ Progress page actions
└── useBrandedSplashActions.ts     ✅ Branded page actions
```

### **CSS Architecture (Centralized)**

**Single Stylesheet Strategy**: All splash styles centralized in `src/styles/splash.css`

**Import Location**: `src/main.tsx` - `import './styles/splash.css'`

**Architectural Benefits**:
- **Centralized Management**: All splash styles in one discoverable location
- **Rapid Development**: Easy to find and modify styles across variants
- **Consistency**: Shared base classes ensure visual uniformity
- **Theme Integration**: CSS custom properties work reliably when defined centrally
- **HMR Support**: Hot Module Replacement works properly with JavaScript imports

## React Spring Integration

### **Animation Library Setup**

**Installation Command:**
```bash
npm install @react-spring/web
```

**For Newer React Versions:**
```bash
npm install @react-spring/web --legacy-peer-deps
```

**Basic Usage Pattern:**
```javascript
import { useSpring, animated } from '@react-spring/web'

const springs = useSpring({
  from: { opacity: 0, transform: 'translateY(20px)' },
  to: { opacity: 1, transform: 'translateY(0px)' }
})

return (
  <animated.div style={springs}>
    Animated content
  </animated.div>
)
```

### **Performance Optimization Principles**

**Animation Property Selection:**
- **Use Only**: `transform`, `opacity`, `filter` properties
- **Avoid**: `width`, `height`, `color`, `background-color` (cause layout recalculation)
- **GPU Acceleration**: `translateZ(0)` and `will-change` for complex animations

**CSS Animation Classes:**
```css
.splash-fade-in {
  animation: splash-entrance 0.6s ease-out forwards;
}

@keyframes splash-entrance {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}
```

### **Reduced Motion Support**
```css
@media (prefers-reduced-motion: reduce) {
  .splash-animation {
    animation: none;
    transition: none;
  }
}
```

## Implementation: Page-Aware Actions System

### **Hooks-Based Page Context Management**

The splash screens integrate with a sophisticated page-aware actions system that provides contextual functionality based on the current page.

#### **usePageActions Hook**
```typescript
// Automatically sets current child page for action sheet context
export const usePageActions = (pageId: string) => {
  const setCurrentChildPage = useAppStore((state) => state.setCurrentChildPage)
  
  useEffect(() => {
    setCurrentChildPage(pageId)  // Set active page context
    
    return () => {
      setCurrentChildPage(null)  // Cleanup on unmount
    }
  }, [pageId, setCurrentChildPage])
}
```

#### **usePageInstructions Hook**
```typescript
// Automatically loads instructions from centralized service
export const usePageInstructions = (pageId: string) => {
  const { setInstructions } = useInstructions()

  useEffect(() => {
    const pageInstructions = instructionsService.getInstructions(pageId)
    if (pageInstructions) {
      setInstructions(pageInstructions.title, [...pageInstructions.instructions])
    }
  }, [pageId, setInstructions])
}
```

### **Action Sheet Integration Pattern**

Each splash screen follows this consistent integration pattern:

```typescript
// Component wrapper pattern
export const MinimalSplashPageWrapper: React.FC = () => {
  usePageInstructions('minimalsplash')  // Load page-specific instructions
  usePageActions('minimalsplash')       // Set action context
  
  return <MinimalSplashPage />
}
```

#### **ActionSheetContainer Mapping**
```typescript
// Dynamic action mapping based on current page
const actionMap: Record<string, Record<string, Fn>> = {
  minimalsplash: {
    'test-minimal-load': minimalSplashActions.testMinimalLoad,
    'restart-animation': minimalSplashActions.restartAnimation,
    'toggle-fullscreen': minimalSplashActions.toggleFullscreen,
    'go-to-animated': minimalSplashActions.goToAnimated,
    'go-to-progress': minimalSplashActions.goToProgress,
    'go-to-branded': minimalSplashActions.goToBranded
  },
  // ... other page mappings
}
```

## Implementation: Animation Restart System

### **Animation Key Pattern**

Every splash screen hook implements a restart mechanism using an animation key pattern:

```typescript
export function useMinimalSplashActions() {
  const [animationKey, setAnimationKey] = useState(0)
  
  const restartAnimation = useCallback(() => {
    setAnimationKey(prev => prev + 1)  // Increment forces re-render
    setProgress(0)                     // Reset any progress state
    setStatus('Initializing...')       // Reset status messages
  }, [])
  
  return {
    restartAnimation,
    animationKey,
    // ... other actions
  }
}
```

#### **Component Integration**
```typescript
// Animation key forces component re-mount, restarting CSS animations
<div key={animationKey} className="splash-fade-in">
  {/* Content re-mounts with fresh animations */}
</div>

// Effect dependencies include animationKey to restart sequences
useEffect(() => {
  // Animation sequence logic
}, [animationKey, chessPieces])
```

### **Progressive Animation Sequences**

Splash screens use sophisticated timing sequences that can be restarted:

```typescript
// Staggered animation timing with cleanup
useEffect(() => {
  const timeouts: NodeJS.Timeout[] = []
  
  chessPieces.forEach((piece, index) => {
    const delay = 800 + (index * 500) // Staggered timing
    const timeout = setTimeout(() => {
      // Animation logic
    }, delay)
    timeouts.push(timeout)
  })
  
  return () => {
    timeouts.forEach(clearTimeout)  // Proper cleanup
  }
}, [animationKey, chessPieces])
```

## Implementation: Critical Design Rules & Constraints

### **🚫 Explicit Design Prohibitions**

#### **1. Bottom UI Placement Rule**
**NEVER place any elements in the bottom third of splash screens**

- **Rationale**: Mobile safe areas, tab bars, and action sheets occupy bottom space
- **Violation Example**: Progress bars at page bottom
- **Correct Approach**: Integrate progress into central design elements
- **Reference**: `splash-center-content` uses `-20vh` margin for proper centering

#### **2. No Audio in Splash Screens**
**Audio is EXPLICITLY prohibited in splash screen animations**

- **Rationale**: Splash screens should be subtle and non-intrusive
- **Implementation**: `testMinimalLoad` callback is empty - no audio calls
- **Exception**: Action button clicks may have UI sound feedback
- **Reference**: Action handlers use `playUIClick()` for user-initiated actions only

#### **3. No Spinning Animations**
**Spinning loaders and spinners are forbidden**

- **Rationale**: Research shows spinners are "UX killers" in 2024-2025
- **Alternative**: Subtle pulse, fade, or progress indicators
- **Implementation**: Use `animate-pulse`, `animate-card-entrance`, not rotational animations
- **Reference**: Modern best practices favor skeleton screens over spinners

#### **4. No False Credentials**
**Never include unauthorized certifications or institutional claims**

- **Violation Example**: "FIDE Approved", "International Chess Federation Recognized"  
- **Correct Approach**: "Premium Training", "Excellence in Chess Education"
- **Legal Risk**: False credential claims create liability issues
- **Reference**: Documented in lessons learned sections

### **✅ Required Design Standards**

#### **1. Theme Variable Compliance**
All colors MUST use CSS custom properties (NO hsl() wrapper):
```css
background: var(--background);
color: var(--foreground); 
border-color: var(--border);

/* For transparency effects, use rgba with RGB fallbacks */
text-shadow: 0 0 15px rgba(var(--accent-rgb, 59 130 246), 0.2);
box-shadow: 0 4px 16px rgba(var(--foreground-rgb, 31 41 55), 0.05);
```

#### **2. Centered Focal Point**
All splash screens must have a clear visual center:
- Use `splash-center-content` class
- Single primary focal element (chess piece, logo)
- Support element hierarchy below focal point

#### **3. Timing Constraints**
- **Maximum Duration**: 3 seconds total animation time
- **Entrance Animation**: 0.6s for `splash-fade-in`
- **Stagger Delays**: 200-500ms between elements
- **Restart Capability**: All animations must support restart via animation key

#### **4. Accessibility Requirements**
```css
@media (prefers-reduced-motion: reduce) {
  .splash-animation {
    animation: none;
    transition: none;
  }
}
```

## Bug Fixes & Technical Resolution

### **TypeScript Compilation Issues** ✅ Fixed

**Problem**: Build failing with unused variable warnings in `useUIClickSound.ts` and `DragTestPage.tsx`

**Solution**: 
- Prefixed unused parameters with underscore (`_context`, `_success`)
- Removed unused imports
- Build now compiles cleanly with exit code 0

### **Action System Integration** ✅ Fixed

**Problem**: Splash page actions appeared in UI but didn't execute when clicked

**Root Cause**: Missing action mappings in `ActionSheetContainer.tsx` - new actions weren't connected to hook functions

**Solution**: Added complete action mappings for all splash pages:

```typescript
const actionMap: Record<string, Record<string, Fn>> = {
  minimalsplash: {
    'test-minimal-load': minimalSplashActions.testMinimalLoad,
    'restart-animation': minimalSplashActions.restartAnimation,
    'toggle-fullscreen': minimalSplashActions.toggleFullscreen,
    'go-to-animated': minimalSplashActions.goToAnimated,
    'go-to-progress': minimalSplashActions.goToProgress,
    'go-to-branded': minimalSplashActions.goToBranded
  },
  // Additional page mappings...
}
```

**Verification**: All splash actions now work: fullscreen toggle, cross-navigation, restart animations

### **CSS Import Strategy Issues** ✅ Fixed

**Problem**: Initial attempt to use `@import './styles/splash.css'` in index.css didn't work reliably

**Solution**: Moved CSS import to JavaScript in `main.tsx`:
```javascript
import './styles/splash.css'
```

**Benefits**:
- Consistent with existing theme CSS imports
- Reliable load order after theme variables are defined  
- HMR (Hot Module Replacement) works properly in development

### **Fullscreen Modal Implementation** ✅ Fixed

**Problem**: Original fullscreen implementation used browser `requestFullscreen()` API which takes over entire browser window

**User Feedback**: "Its making the app fullscreen instead of popping out that splash page as a full screen overlay"

**Solution**: Created dedicated splash modal overlay system:

**SplashModal Component Features**:
- `fixed inset-0 z-[9999]` - Covers entire app viewport
- Backdrop blur with click-to-close functionality
- Close button (X) in top-right corner
- ESC key support (inherited from existing modal patterns)
- Stays within browser window (no browser fullscreen)

**Benefits**:
- Professional splash screen demo experience
- User retains browser controls (back, refresh, bookmarks)
- Consistent behavior across all devices and browsers
- Easy to close with multiple options (click backdrop, close button, ESC key)

### **Layout Context Overflow Issues** ✅ Fixed

**Problem**: Splash pages were causing scrollbars and overflow when displayed in app tabs

**User Feedback**: "scroll bars on these pages now, so the pages aren't resizing to fit the view port before popping out"

**Root Cause**: Splash pages were using full viewport dimensions (100vh/100vw) in constrained app layout contexts

**Solution - Context-Aware CSS Variants**: Implemented variant prop system:

```css
/* In-app variant - fits within app layout */
.splash-container.splash-in-app {
  min-height: 100vh;
  width: 100%;
  padding: 0;
}

/* Modal variant - full viewport takeover */
.splash-container.splash-modal {
  min-height: 100vh;
  width: 100vw;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 50;
}
```

**Code Quality Improvements**:
- ✅ **Eliminated duplication**: Removed 4 duplicate modal-splash components
- ✅ **Single source of truth**: One component handles both contexts via props
- ✅ **DRY principle**: No code duplication, easier maintenance
- ✅ **Build optimization**: Reduced module count

## Advanced Implementation Details

### **Responsive Design Architecture**

**Mobile-First Breakpoints**:
```css
/* Mobile base styles */
.splash-title { font-size: 32px; }

/* Tablet and up */
@media (min-width: 768px) {
  .splash-title { font-size: 40px; }
}

/* Desktop and up */
@media (min-width: 1024px) {
  .splash-title { font-size: 60px; }
}
```

**Typography Scaling System**:
- **Desktop**: 60px → 40px → 32px progressive scaling
- **Padding Adjustments**: Responsive spacing for smaller screens
- **Touch Targets**: Minimum 44px for mobile interaction

### **Theme Integration System**

**CSS Custom Properties Usage**:
```css
.splash-container {
  background: var(--background);
  color: var(--foreground);
  border-color: var(--border);
}

/* Gradient text effects */
.text-gaming-gradient {
  background: linear-gradient(135deg, 
    var(--accent), 
    var(--accent-secondary)
  );
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
}

/* Transparency effects with rgba */
.splash-glow {
  text-shadow: 0 0 20px rgba(var(--accent-rgb, 59 130 246), 0.3);
  box-shadow: 0 4px 16px rgba(var(--foreground-rgb, 31 41 55), 0.05);
}
```

**Available Design System Assets**:
- **Animations**: `@keyframes float`, `drift`, `pulse-glow`
- **Components**: `.card-gaming`, `.glass`, `.shadow-gaming`  
- **Gradients**: `.bg-gaming-gradient`, `.text-gaming-gradient`
- **Typography**: Font weight and size variations

### **Cross-Navigation Implementation**

**Navigation Logic Pattern**:
```typescript
// Cross-page navigation in splash hooks
const goToAnimated = useCallback(() => {
  setCurrentChildPage('animatedsplash')
}, [setCurrentChildPage])

const goToProgress = useCallback(() => {
  setCurrentChildPage('loadingprogress')
}, [setCurrentChildPage])

const goToBranded = useCallback(() => {
  setCurrentChildPage('brandedsplash')
}, [setCurrentChildPage])
```

**Router Integration**:
- Uses existing `currentChildPage` state from Zustand store
- `SplashPage` component acts as router for child pages
- No wrapper constraints - direct component rendering
- Maintains action sheet context for each child page

### **Animation Choreography Examples**

**Staggered Chess Piece Animation**:
```typescript
useEffect(() => {
  const timeouts: NodeJS.Timeout[] = []
  
  chessPieces.forEach((piece, index) => {
    const delay = 800 + (index * 500) // Staggered timing
    const timeout = setTimeout(() => {
      setVisiblePieces(prev => [...prev, piece])
    }, delay)
    timeouts.push(timeout)
  })
  
  return () => {
    timeouts.forEach(clearTimeout) // Cleanup on unmount
  }
}, [animationKey, chessPieces])
```

**Progressive Loading Simulation**:
```typescript
const stages = [
  { progress: 30, message: "Loading Opening Database...", duration: 800 },
  { progress: 60, message: "Initializing Engine...", duration: 600 },
  { progress: 85, message: "Loading Tablebase...", duration: 400 },
  { progress: 100, message: "Ready to Play!", duration: 200 }
]

useEffect(() => {
  stages.forEach((stage, index) => {
    const delay = index * 1000
    setTimeout(() => {
      setProgress(stage.progress)
      setStatus(stage.message)
    }, delay)
  })
}, [animationKey])
```